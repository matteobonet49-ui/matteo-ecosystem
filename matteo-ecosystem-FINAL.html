<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Matt√©o Ecosystem - I can? I will</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3B82F6',
                        accent: '#F97316',
                    }
                }
            }
        }
    </script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #1E3A8A 0%, #3B82F6 50%, #F97316 100%); }
        .card { background: white; border-radius: 1rem; padding: 1.5rem; box-shadow: 0 1px 3px rgba(0,0,0,0.1); transition: all 0.3s; }
        .card:hover { box-shadow: 0 4px 12px rgba(0,0,0,0.15); transform: translateY(-2px); }
        .stat-card { background: linear-gradient(135deg, #3B82F6 0%, #F97316 100%); color: white; border-radius: 1rem; padding: 1.5rem; }
        .btn-primary { background: linear-gradient(135deg, #3B82F6 0%, #F97316 100%); color: white; padding: 0.75rem 1.5rem; border-radius: 0.5rem; font-weight: 600; border: none; cursor: pointer; }
        .btn-primary:hover { box-shadow: 0 4px 12px rgba(59,130,246,0.4); transform: translateY(-2px); }
        .nav-btn.active { background: linear-gradient(135deg, #3B82F6 0%, #F97316 100%); color: white; border-radius: 0.5rem; }
        .progress-bar { height: 8px; background: #E5E7EB; border-radius: 9999px; overflow: hidden; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, #3B82F6 0%, #F97316 100%); border-radius: 9999px; }
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.5); display: none; align-items: center; justify-content: center; z-index: 100; }
        .modal.active { display: flex; }
        .badge { display: inline-block; padding: 0.25rem 0.75rem; border-radius: 9999px; font-size: 0.75rem; font-weight: 600; }
        .badge-success { background: #D1FAE5; color: #065F46; }
        .badge-warning { background: #FEF3C7; color: #92400E; }
        .badge-danger { background: #FEE2E2; color: #991B1B; }
        .badge-link { background: linear-gradient(135deg, #A78BFA 0%, #EC4899 100%); color: white; }
        input, select, textarea { width: 100%; padding: 0.75rem; border: 1px solid #D1D5DB; border-radius: 0.5rem; }
        input:focus, select:focus, textarea:focus { outline: none; border-color: #3B82F6; box-shadow: 0 0 0 3px rgba(59,130,246,0.1); }
        table { width: 100%; border-collapse: collapse; }
        th { background: #F9FAFB; padding: 0.75rem; text-align: left; font-weight: 600; border-bottom: 2px solid #E5E7EB; }
        td { padding: 0.75rem; border-bottom: 1px solid #E5E7EB; }
        tr:hover { background: #F9FAFB; }
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 0.5rem; }
        .calendar-day { padding: 0.75rem; border: 1px solid #E5E7EB; border-radius: 0.5rem; min-height: 80px; cursor: pointer; transition: all 0.2s; }
        .calendar-day:hover { background: #F3F4F6; border-color: #3B82F6; }
        .calendar-day.today { border: 2px solid #3B82F6; background: #EFF6FF; }
        .event-dot { width: 8px; height: 8px; border-radius: 50%; display: inline-block; margin-right: 4px; }
    </style>
</head>
<body class="bg-gray-50">

<!-- Header -->
<header class="gradient-bg text-white shadow-lg sticky top-0 z-50">
    <div class="max-w-7xl mx-auto px-4 py-4">
        <div class="flex justify-between items-center">
            <div class="flex items-center space-x-3">
                <div class="w-10 h-10 bg-white/20 rounded-lg flex items-center justify-center text-xl font-bold">ME</div>
                <div>
                    <h1 class="text-xl font-bold">Matt√©o Ecosystem</h1>
                    <p class="text-xs text-white/80">I can? I will</p>
                </div>
            </div>
            <button onclick="exportData()" class="bg-white/20 hover:bg-white/30 px-4 py-2 rounded-lg text-sm">
                üíæ Exporter
            </button>
        </div>
    </div>
</header>

<!-- Navigation -->
<nav class="bg-white border-b sticky top-16 z-40">
    <div class="max-w-7xl mx-auto px-4">
        <div class="flex space-x-2 overflow-x-auto py-2">
            <button class="nav-btn px-4 py-2 text-sm font-medium whitespace-nowrap" onclick="showSection('dashboard')">üè† Dashboard</button>
            <button class="nav-btn px-4 py-2 text-sm font-medium whitespace-nowrap" onclick="showSection('travail')">üíº Travail</button>
            <button class="nav-btn px-4 py-2 text-sm font-medium whitespace-nowrap" onclick="showSection('budget')">üí∞ Budget</button>
            <button class="nav-btn px-4 py-2 text-sm font-medium whitespace-nowrap" onclick="showSection('personnel')">üìÖ Personnel</button>
            <button class="nav-btn px-4 py-2 text-sm font-medium whitespace-nowrap" onclick="showSection('projets')">üöÄ Projets</button>
            <button class="nav-btn px-4 py-2 text-sm font-medium whitespace-nowrap" onclick="showSection('contacts')">üë• Contacts</button>
            <button class="nav-btn px-4 py-2 text-sm font-medium whitespace-nowrap" onclick="showSection('admin')">üìã Admin</button>
            <button class="nav-btn px-4 py-2 text-sm font-medium whitespace-nowrap" onclick="showSection('loisirs')">üéÆ Loisirs</button>
            <button class="nav-btn px-4 py-2 text-sm font-medium whitespace-nowrap" onclick="showSection('sante')">üè• Sant√©</button>
        </div>
    </div>
</nav>

<!-- Contenu Principal -->
<main class="max-w-7xl mx-auto px-4 py-6" id="content">
    <!-- Le contenu sera inject√© ici -->
</main>

<!-- Modal g√©n√©rique -->
<div id="modal" class="modal">
    <div class="bg-white rounded-2xl p-6 max-w-md w-full mx-4 max-h-[90vh] overflow-y-auto">
        <div class="flex justify-between items-center mb-4">
            <h3 class="text-xl font-bold" id="modalTitle">Modal</h3>
            <button onclick="closeModal()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
        </div>
        <div id="modalContent"></div>
    </div>
</div>

<script>
// ========================================
// SYST√àME DE STOCKAGE (LocalStorage)
// ========================================

const STORAGE_KEY = 'matteo_ecosystem_data';

function loadData() {
    const data = localStorage.getItem(STORAGE_KEY);
    return data ? JSON.parse(data) : {
        userInfo: {
            name: 'Matt√©o Bonet',
            age: 22,
            birthdate: '2002-01-15'
        },
        preferences: {
            preparationTime: 60,
            wakeUpBuffer: 10,
            sleepGoal: 7.5,
            notificationFrequency: 'daily'
        },
        travail: { objectifs: [] },
        budget: { comptes: [], transactions: [], credits: [], epargnes: [], assurances: [] },
        personnel: { events: [], notes: [], routines: [], preferences: {} },
        projets: { projets: [], rejectedSuggestions: [] },
        contacts: { contacts: [] },
        admin: { documents: [] },
        loisirs: { voyages: [], livres: [], sports: [], hobbies: [] },
        sante: { sommeil: [], nutrition: [], rdv: [] },
        interconnections: []
    };
}

function saveData(data) {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
}

let appData = loadData();

// ========================================
// SYST√àME D'INTERCONNEXIONS
// ========================================

function addInterconnection(source, target, type, data = {}) {
    const interconnection = {
        id: Date.now() + Math.random(),
        source,
        target,
        type,
        data,
        createdAt: new Date().toISOString()
    };
    appData.interconnections = appData.interconnections || [];
    appData.interconnections.push(interconnection);
    saveData(appData);
    return interconnection;
}

function getInterconnections(filter = {}) {
    if (!appData.interconnections) return [];
    let results = appData.interconnections;
    
    if (filter.source) results = results.filter(i => i.source === filter.source);
    if (filter.target) results = results.filter(i => i.target === filter.target);
    if (filter.type) results = results.filter(i => i.type === filter.type);
    
    return results;
}

function removeInterconnection(id) {
    if (!appData.interconnections) return;
    appData.interconnections = appData.interconnections.filter(i => i.id !== id);
    saveData(appData);
}

// Auto-calculer r√©veil pour √©v√©nement
function calculateWakeUpTime(event) {
    if (!event.time) return null;
    
    const eventTime = new Date(`${event.date} ${event.time}`);
    const prepTime = appData.preferences.preparationTime || 60;
    const wakeTime = new Date(eventTime.getTime() - prepTime * 60000);
    
    return wakeTime.toTimeString().slice(0, 5);
}

// ========================================
// NAVIGATION
// ========================================

let currentSection = 'dashboard';

function showSection(section) {
    currentSection = section;
    
    // Mettre √† jour nav active
    document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
    const activeBtn = Array.from(document.querySelectorAll('.nav-btn')).find(btn => 
        btn.textContent.toLowerCase().includes(section) || 
        (section === 'dashboard' && btn.textContent.includes('Dashboard'))
    );
    if (activeBtn) activeBtn.classList.add('active');
    
    // Charger le contenu
    const content = document.getElementById('content');
    
    switch(section) {
        case 'dashboard':
            content.innerHTML = renderDashboard();
            setTimeout(() => initDashboardCharts(), 100);
            break;
        case 'travail':
            content.innerHTML = renderTravail();
            break;
        case 'budget':
            content.innerHTML = renderBudget();
            break;
        case 'personnel':
            content.innerHTML = renderPersonnel();
            setTimeout(() => renderCalendar(), 100);
            break;
        case 'projets':
            content.innerHTML = renderProjets();
            break;
        case 'contacts':
            content.innerHTML = renderContacts();
            break;
        case 'admin':
            content.innerHTML = renderAdmin();
            break;
        case 'loisirs':
            content.innerHTML = renderLoisirs();
            setTimeout(() => showLoisirsTab('voyages'), 100);
            break;
        case 'sante':
            content.innerHTML = renderSante();
            setTimeout(() => showSanteTab('sommeil'), 100);
            break;
    }
}

// ========================================
// DASHBOARD
// ========================================

function renderDashboard() {
    try {
        const stats = calculateStats();
        const recentInterconnections = (appData.interconnections || []).slice(-5).reverse();
        const scoreSante = calculateScoreSante();
        
        return `
            <div>
                <h1 class="text-3xl font-bold mb-6">üè† Dashboard</h1>
                
                <!-- Stats Cards -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                    <div class="stat-card">
                        <p class="text-sm opacity-90 mb-1">Patrimoine Net</p>
                        <p class="text-2xl font-bold">${formatEuro(stats.patrimoine)}</p>
                    </div>
                    <div class="stat-card">
                        <p class="text-sm opacity-90 mb-1">Objectifs Travail</p>
                        <p class="text-2xl font-bold">${stats.objectifs}</p>
                    </div>
                    <div class="stat-card">
                        <p class="text-sm opacity-90 mb-1">Projets Actifs</p>
                        <p class="text-2xl font-bold">${stats.projets}</p>
                    </div>
                    <div class="stat-card">
                        <p class="text-sm opacity-90 mb-1">Score Sant√©</p>
                        <p class="text-2xl font-bold">${scoreSante}%</p>
                    </div>
                </div>

                <!-- Interconnexions Actives -->
                <div class="card mb-6">
                    <h2 class="text-xl font-bold mb-4">üîó Interconnexions Actives (${(appData.interconnections || []).length})</h2>
                    ${(appData.interconnections || []).length === 0 ? `
                        <p class="text-gray-500 text-center py-8">Aucune interconnexion pour le moment. Cr√©ez des √©l√©ments pour voir les liens automatiques !</p>
                    ` : `
                        <div class="space-y-2">
                            ${recentInterconnections.map(inter => `
                                <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                    <div class="flex items-center space-x-3">
                                        <span class="badge badge-link">üîó</span>
                                        <span class="text-sm">${getInterconnectionLabel(inter)}</span>
                                    </div>
                                    <span class="text-xs text-gray-500">${formatDate(inter.createdAt)}</span>
                                </div>
                            `).join('')}
                        </div>
                        ${(appData.interconnections || []).length > 5 ? `
                            <p class="text-sm text-gray-500 text-center mt-4">+ ${(appData.interconnections || []).length - 5} autres interconnexions</p>
                        ` : ''}
                    `}
                </div>

                <!-- √âv√©nements √† venir -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                    <div class="card">
                        <h2 class="text-xl font-bold mb-4">üìÖ Prochains √âv√©nements</h2>
                        ${renderUpcomingEvents()}
                    </div>
                    
                    <div class="card">
                        <h2 class="text-xl font-bold mb-4">üéØ Objectifs en Cours</h2>
                        ${renderActiveObjectifs()}
                    </div>
                </div>

                <!-- Graphiques -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="card">
                        <h3 class="font-bold mb-4">üìä R√©partition Patrimoine</h3>
                        <div style="position: relative; height: 250px; max-width: 100%;">
                            <canvas id="patrimoineChart"></canvas>
                        </div>
                    </div>
                    <div class="card">
                        <h3 class="font-bold mb-4">üìà √âvolution Budget (30j)</h3>
                        <div style="position: relative; height: 250px; max-width: 100%;">
                            <canvas id="budgetChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        `;
    } catch (error) {
        console.error('Erreur Dashboard:', error);
        return `
            <div class="card">
                <h1 class="text-3xl font-bold mb-4 text-red-600">‚ö†Ô∏è Erreur Dashboard</h1>
                <p class="text-gray-700 mb-4">Une erreur s'est produite lors du chargement du Dashboard.</p>
                <pre class="bg-gray-100 p-4 rounded text-xs overflow-auto">${error.message}\n${error.stack}</pre>
                <button onclick="location.reload()" class="btn-primary mt-4">üîÑ Recharger la page</button>
            </div>
        `;
    }
}

function renderDashboardCard(icon, title, details) {
    return `
        <div class="card">
            <h3 class="text-lg font-bold mb-3">${icon} ${title}</h3>
            <div class="space-y-2">
                ${details.map(d => `<div class="flex justify-between text-sm">
                    <span class="text-gray-600">${d.label}</span>
                    <span class="font-semibold">${d.value}</span>
                </div>`).join('')}
            </div>
        </div>
    `;
}

function calculateStats() {
    return {
        patrimoine: appData.budget.comptes.reduce((sum, c) => sum + (c.solde || 0), 0),
        objectifs: appData.travail.objectifs.length,
        projets: appData.projets.projets.length,
        budgetMois: appData.budget.transactions
            .filter(t => new Date(t.date).getMonth() === new Date().getMonth())
            .reduce((sum, t) => sum + (t.type === 'expense' ? -t.montant : t.montant), 0),
        travailDetail: [
            { label: 'Court terme', value: appData.travail.objectifs.filter(o => o.type === 'CT').length },
            { label: 'Moyen terme', value: appData.travail.objectifs.filter(o => o.type === 'MT').length },
            { label: 'Long terme', value: appData.travail.objectifs.filter(o => o.type === 'LT').length }
        ],
        budgetDetail: [
            { label: 'Comptes', value: appData.budget.comptes.length },
            { label: 'Transactions', value: appData.budget.transactions.length },
            { label: 'Cr√©dits', value: appData.budget.credits.length }
        ],
        projetsDetail: [
            { label: 'Personnel', value: appData.projets.projets.filter(p => p.categories.includes('personnel')).length },
            { label: 'Professionnel', value: appData.projets.projets.filter(p => p.categories.includes('professionnel')).length },
            { label: 'Patrimoine', value: appData.projets.projets.filter(p => p.categories.includes('patrimoine')).length }
        ],
        personnelDetail: [
            { label: '√âv√©nements', value: appData.personnel.events.length },
            { label: 'Notes', value: appData.personnel.notes.length },
            { label: 'Routines', value: appData.personnel.routines.length }
        ],
        loisirsDetail: [
            { label: 'Voyages', value: appData.loisirs.voyages.length },
            { label: 'Livres', value: appData.loisirs.livres.length },
            { label: 'Sport', value: (appData.loisirs.sports || []).length }
        ],
        santeDetail: [
            { label: 'Sommeil moyen', value: '7.2h' },
            { label: 'RDV', value: appData.sante.rdv.length },
            { label: 'Suivi actif', value: 'Oui' }
        ]
    };
}

function calculateScoreSante() {
    let score = 0;
    let factors = 0;
    
    // Sommeil (40 points)
    if (appData.sante.sommeil.length > 0) {
        const recent = appData.sante.sommeil.slice(-7);
        const avgSleep = recent.reduce((sum, s) => sum + s.heures, 0) / recent.length;
        const sleepGoal = appData.preferences.sleepGoal || 7.5;
        const sleepScore = Math.min(100, (avgSleep / sleepGoal) * 100);
        score += sleepScore * 0.4;
        factors++;
    }
    
    // Sport (40 points)
    if (appData.loisirs.sports && appData.loisirs.sports.length > 0) {
        const thisWeek = appData.loisirs.sports.filter(s => {
            const date = new Date(s.date);
            const weekAgo = new Date();
            weekAgo.setDate(weekAgo.getDate() - 7);
            return date >= weekAgo;
        }).length;
        const sportScore = Math.min(100, (thisWeek / 3) * 100);
        score += sportScore * 0.4;
        factors++;
    }
    
    // RDV Sant√© √† jour (20 points)
    const upcomingRDV = appData.sante.rdv.filter(r => new Date(r.date) >= new Date()).length;
    if (upcomingRDV > 0) {
        score += 20;
        factors++;
    }
    
    return factors > 0 ? Math.round(score / factors * 100) / 100 : 0;
}

function getInterconnectionLabel(inter) {
    const types = {
        'voyage_to_event': '‚úàÔ∏è Voyage ‚Üí üìÖ √âv√©nement',
        'projet_patrimoine': 'üöÄ Projet ‚Üí üí∞ Patrimoine',
        'event_wake_up': 'üìÖ √âv√©nement ‚Üí ‚è∞ R√©veil',
        'contact_birthday': 'üë• Contact ‚Üí üéÇ Anniversaire',
        'transaction_voyage': 'üí∞ Transaction ‚Üí ‚úàÔ∏è Voyage',
        'transaction_projet': 'üí∞ Transaction ‚Üí üöÄ Projet',
        'objectif_cost': 'üíº Objectif ‚Üí üí∞ Budget'
    };
    return types[inter.type] || 'üîó Interconnexion';
}

function renderUpcomingEvents() {
    const upcoming = appData.personnel.events
        .filter(e => new Date(e.date) >= new Date())
        .sort((a, b) => new Date(a.date) - new Date(b.date))
        .slice(0, 5);
    
    if (upcoming.length === 0) {
        return `<p class="text-gray-500 text-center py-4">Aucun √©v√©nement √† venir</p>`;
    }
    
    return `
        <div class="space-y-2">
            ${upcoming.map(event => {
                const wakeTime = calculateWakeUpTime(event);
                return `
                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                        <div>
                            <p class="font-semibold">${event.title}</p>
                            <p class="text-sm text-gray-600">${formatDate(event.date)} ${event.time ? '√† ' + event.time : ''}</p>
                            ${wakeTime ? `<p class="text-xs text-blue-600">‚è∞ R√©veil sugg√©r√©: ${wakeTime}</p>` : ''}
                        </div>
                        <span class="event-dot" style="background: ${event.color || '#3B82F6'}"></span>
                    </div>
                `;
            }).join('')}
        </div>
    `;
}

function renderActiveObjectifs() {
    const actifs = appData.travail.objectifs.filter(o => !o.completed).slice(0, 5);
    
    if (actifs.length === 0) {
        return `<p class="text-gray-500 text-center py-4">Aucun objectif actif</p>`;
    }
    
    return `
        <div class="space-y-3">
            ${actifs.map(obj => `
                <div class="p-3 bg-gray-50 rounded-lg">
                    <div class="flex items-center justify-between mb-2">
                        <span class="font-semibold text-sm">${obj.title}</span>
                        <span class="badge badge-${obj.type === 'CT' ? 'danger' : obj.type === 'MT' ? 'warning' : 'info'}">${obj.type}</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${obj.progress || 0}%"></div>
                    </div>
                    <p class="text-xs text-gray-600 mt-1">${obj.progress || 0}% compl√©t√©</p>
                </div>
            `).join('')}
        </div>
    `;
}

function initDashboardCharts() {
    // D√©truire les anciens graphiques s'ils existent
    if (window.patrimoineChartInstance) {
        window.patrimoineChartInstance.destroy();
    }
    if (window.budgetChartInstance) {
        window.budgetChartInstance.destroy();
    }
    
    // Graphique Patrimoine
    const patrimoineCtx = document.getElementById('patrimoineChart');
    if (patrimoineCtx && typeof Chart !== 'undefined') {
        const comptes = appData.budget.comptes;
        if (comptes.length > 0) {
            try {
                const types = [...new Set(comptes.map(c => c.type))];
                const data = types.map(type => 
                    comptes.filter(c => c.type === type).reduce((sum, c) => sum + c.solde, 0)
                );
                
                window.patrimoineChartInstance = new Chart(patrimoineCtx, {
                    type: 'doughnut',
                    data: {
                        labels: types,
                        datasets: [{
                            data: data,
                            backgroundColor: ['#3B82F6', '#F97316', '#10B981', '#8B5CF6', '#EC4899']
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        plugins: {
                            legend: {
                                position: 'bottom'
                            }
                        }
                    }
                });
            } catch (error) {
                console.error('Erreur graphique patrimoine:', error);
                patrimoineCtx.parentElement.innerHTML = '<p class="text-gray-500 text-center py-8">Graphique indisponible</p>';
            }
        }
    }
    
    // Graphique Budget
    const budgetCtx = document.getElementById('budgetChart');
    if (budgetCtx && typeof Chart !== 'undefined') {
        try {
            const last30Days = [];
            const revenues = [];
            const expenses = [];
            
            for (let i = 29; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                const dateStr = date.toISOString().split('T')[0];
                last30Days.push(dateStr);
                
                const dayTransactions = appData.budget.transactions.filter(t => t.date === dateStr);
                revenues.push(dayTransactions.filter(t => t.type === 'income').reduce((sum, t) => sum + t.montant, 0));
                expenses.push(dayTransactions.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.montant, 0));
            }
            
            window.budgetChartInstance = new Chart(budgetCtx, {
                type: 'line',
                data: {
                    labels: last30Days.map(d => new Date(d).getDate()),
                    datasets: [
                        {
                            label: 'Revenus',
                            data: revenues,
                            borderColor: '#10B981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            tension: 0.4
                        },
                        {
                            label: 'D√©penses',
                            data: expenses,
                            borderColor: '#EF4444',
                            backgroundColor: 'rgba(239, 68, 68, 0.1)',
                            tension: 0.4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        } catch (error) {
            console.error('Erreur graphique budget:', error);
            budgetCtx.parentElement.innerHTML = '<p class="text-gray-500 text-center py-8">Graphique indisponible</p>';
        }
    }
}

// ========================================
// SECTION TRAVAIL
// ========================================

function renderTravail() {
    return `
        <div>
            <div class="flex justify-between items-center mb-6">
                <h1 class="text-3xl font-bold">üíº Travail</h1>
                <button onclick="ajouterObjectif()" class="btn-primary">‚ûï Nouvel Objectif</button>
            </div>

            <!-- Court Terme -->
            <div class="card mb-4">
                <h2 class="text-xl font-bold mb-4 flex items-center">
                    <span class="badge badge-danger mr-2">CT</span>
                    Objectifs Court Terme
                </h2>
                ${renderObjectifsList('CT')}
            </div>

            <!-- Moyen Terme -->
            <div class="card mb-4">
                <h2 class="text-xl font-bold mb-4 flex items-center">
                    <span class="badge badge-warning mr-2">MT</span>
                    Objectifs Moyen Terme
                </h2>
                ${renderObjectifsList('MT')}
            </div>

            <!-- Long Terme -->
            <div class="card">
                <h2 class="text-xl font-bold mb-4 flex items-center">
                    <span class="badge badge-info mr-2">LT</span>
                    Objectifs Long Terme
                </h2>
                ${renderObjectifsList('LT')}
            </div>
        </div>
    `;
}

function renderObjectifsList(type) {
    const objectifs = appData.travail.objectifs.filter(o => o.type === type);
    
    if (objectifs.length === 0) {
        return '<p class="text-gray-500 text-center py-4">Aucun objectif</p>';
    }
    
    return `
        <div class="space-y-2">
            ${objectifs.map((obj, idx) => `
                <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                    <div class="flex-1">
                        <p class="font-semibold">${obj.titre}</p>
                        ${obj.description ? `<p class="text-sm text-gray-600">${obj.description}</p>` : ''}
                        ${obj.echeance ? `<p class="text-xs text-gray-500">üìÖ ${formatDate(obj.echeance)}</p>` : ''}
                    </div>
                    <button onclick="supprimerObjectif('${type}', ${idx})" class="text-red-500 hover:text-red-700 ml-4">üóëÔ∏è</button>
                </div>
            `).join('')}
        </div>
    `;
}

function ajouterObjectif() {
    openModal('Nouvel Objectif', `
        <form onsubmit="saveObjectif(event)" class="space-y-4">
            <div>
                <label class="block text-sm font-medium mb-2">Type</label>
                <select name="type" required class="w-full">
                    <option value="CT">Court Terme</option>
                    <option value="MT">Moyen Terme</option>
                    <option value="LT">Long Terme</option>
                </select>
            </div>
            <div>
                <label class="block text-sm font-medium mb-2">Titre</label>
                <input type="text" name="titre" required placeholder="Ex: R√©ussir examen Finance">
            </div>
            <div>
                <label class="block text-sm font-medium mb-2">Description</label>
                <textarea name="description" rows="3" placeholder="D√©tails..."></textarea>
            </div>
            <div>
                <label class="block text-sm font-medium mb-2">√âch√©ance (optionnel)</label>
                <input type="date" name="echeance">
            </div>
            <button type="submit" class="btn-primary w-full">Ajouter</button>
        </form>
    `);
}

function saveObjectif(e) {
    e.preventDefault();
    const form = e.target;
    const objectif = {
        type: form.type.value,
        titre: form.titre.value,
        description: form.description.value,
        echeance: form.echeance.value,
        createdAt: new Date().toISOString()
    };
    
    appData.travail.objectifs.push(objectif);
    saveData(appData);
    closeModal();
    showSection('travail');
    showToast('Objectif ajout√© !', 'success');
}

function supprimerObjectif(type, index) {
    if (confirm('Supprimer cet objectif ?')) {
        const objIndex = appData.travail.objectifs.findIndex((o, i) => o.type === type && appData.travail.objectifs.filter(obj => obj.type === type).indexOf(o) === index);
        appData.travail.objectifs.splice(objIndex, 1);
        saveData(appData);
        showSection('travail');
        showToast('Objectif supprim√©', 'success');
    }
}

// ========================================
// SECTION BUDGET (Suite dans le prochain message car trop long)
// ========================================

function renderBudget() {
    const total = appData.budget.comptes.reduce((sum, c) => sum + (c.solde || 0), 0);
    
    return `
        <div>
            <div class="flex justify-between items-center mb-6">
                <h1 class="text-3xl font-bold">üí∞ Patrimoine & Budget</h1>
                <button onclick="ajouterCompte()" class="btn-primary">‚ûï Nouveau Compte</button>
            </div>

            <!-- Total -->
            <div class="stat-card mb-6">
                <p class="text-sm opacity-90 mb-1">Patrimoine Total</p>
                <p class="text-3xl font-bold">${formatEuro(total)}</p>
            </div>

            <!-- Comptes -->
            <div class="card mb-6">
                <h2 class="text-xl font-bold mb-4">üí≥ Mes Comptes</h2>
                ${renderComptesList()}
            </div>

            <!-- Transactions r√©centes -->
            <div class="card">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-bold">üìù Transactions</h2>
                    <button onclick="ajouterTransaction()" class="btn-primary">‚ûï Transaction</button>
                </div>
                ${renderTransactionsList()}
            </div>
        </div>
    `;
}

function renderComptesList() {
    if (appData.budget.comptes.length === 0) {
        return '<p class="text-gray-500 text-center py-4">Aucun compte. Ajoutez-en un !</p>';
    }
    
    return appData.budget.comptes.map((compte, idx) => `
        <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg mb-2">
            <div>
                <p class="font-semibold">${compte.nom}</p>
                <p class="text-sm text-gray-600">${compte.type}</p>
            </div>
            <div class="text-right">
                <p class="text-xl font-bold">${formatEuro(compte.solde)}</p>
                <button onclick="supprimerCompte(${idx})" class="text-red-500 text-sm">Supprimer</button>
            </div>
        </div>
    `).join('');
}

function renderTransactionsList() {
    const recent = appData.budget.transactions.slice(-10).reverse();
    
    if (recent.length === 0) {
        return '<p class="text-gray-500 text-center py-4">Aucune transaction</p>';
    }
    
    return `
        <div class="overflow-x-auto">
            <table>
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Description</th>
                        <th>Montant</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    ${recent.map((t, idx) => `
                        <tr>
                            <td>${formatDate(t.date)}</td>
                            <td>${t.description}</td>
                            <td class="${t.type === 'expense' ? 'text-red-600' : 'text-green-600'} font-semibold">
                                ${t.type === 'expense' ? '-' : '+'}${formatEuro(Math.abs(t.montant))}
                            </td>
                            <td><button onclick="supprimerTransaction(${appData.budget.transactions.length - 1 - idx})" class="text-red-500">üóëÔ∏è</button></td>
                        </tr>
                    `).join('')}
                </tbody>
            </table>
        </div>
    `;
}

function ajouterCompte() {
    openModal('Nouveau Compte', `
        <form onsubmit="saveCompte(event)" class="space-y-4">
            <div>
                <label class="block text-sm font-medium mb-2">Nom du compte</label>
                <input type="text" name="nom" required placeholder="Ex: Compte Courant">
            </div>
            <div>
                <label class="block text-sm font-medium mb-2">Type</label>
                <select name="type" required>
                    <option value="Courant">Courant</option>
                    <option value="√âpargne">√âpargne</option>
                    <option value="Livret">Livret</option>
                    <option value="Investissement">Investissement</option>
                </select>
            </div>
            <div>
                <label class="block text-sm font-medium mb-2">Solde initial</label>
                <input type="number" name="solde" step="0.01" required placeholder="0.00">
            </div>
            <button type="submit" class="btn-primary w-full">Ajouter</button>
        </form>
    `);
}

function saveCompte(e) {
    e.preventDefault();
    const form = e.target;
    appData.budget.comptes.push({
        nom: form.nom.value,
        type: form.type.value,
        solde: parseFloat(form.solde.value),
        createdAt: new Date().toISOString()
    });
    saveData(appData);
    closeModal();
    showSection('budget');
    showToast('Compte ajout√© !', 'success');
}

function ajouterTransaction() {
    openModal('Nouvelle Transaction', `
        <form onsubmit="saveTransaction(event)" class="space-y-4">
            <div>
                <label class="block text-sm font-medium mb-2">Type</label>
                <select name="type" required>
                    <option value="expense">D√©pense</option>
                    <option value="income">Revenu</option>
                </select>
            </div>
            <div>
                <label class="block text-sm font-medium mb-2">Montant (‚Ç¨)</label>
                <input type="number" name="montant" step="0.01" required placeholder="0.00">
            </div>
            <div>
                <label class="block text-sm font-medium mb-2">Description</label>
                <input type="text" name="description" required placeholder="Ex: Courses supermarch√©">
            </div>
            <div>
                <label class="block text-sm font-medium mb-2">Date</label>
                <input type="date" name="date" required value="${new Date().toISOString().split('T')[0]}">
            </div>
            <button type="submit" class="btn-primary w-full">Ajouter</button>
        </form>
    `);
}

function saveTransaction(e) {
    e.preventDefault();
    const form = e.target;
    const transaction = {
        type: form.type.value,
        montant: parseFloat(form.montant.value),
        description: form.description.value,
        date: form.date.value,
        createdAt: new Date().toISOString()
    };
    appData.budget.transactions.push(transaction);
    saveData(appData);
    closeModal();
    showSection('budget');
    showToast('Transaction ajout√©e !', 'success');
}

function supprimerCompte(index) {
    if (confirm('Supprimer ce compte ?')) {
        appData.budget.comptes.splice(index, 1);
        saveData(appData);
        showSection('budget');
    }
}

function supprimerTransaction(index) {
    appData.budget.transactions.splice(index, 1);
    saveData(appData);
    showSection('budget');
}

// ========================================
// SECTIONS SIMPLIFI√âES (√† compl√©ter)
// ========================================

// ========================================
// SECTION PERSONNEL
// ========================================

let currentMonth = new Date().getMonth();
let currentYear = new Date().getFullYear();

function renderPersonnel() {
    setTimeout(() => renderCalendar(), 100);
    
    return `
        <div>
            <h1 class="text-3xl font-bold mb-6">üìÖ Personnel</h1>
            
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                <!-- Calendrier -->
                <div class="lg:col-span-2 card">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl font-bold">Calendrier</h2>
                        <div class="flex gap-2">
                            <button onclick="previousMonth()" class="px-3 py-1 bg-gray-100 rounded hover:bg-gray-200">‚Üê</button>
                            <span id="calendar-title" class="px-4 py-1 font-semibold"></span>
                            <button onclick="nextMonth()" class="px-3 py-1 bg-gray-100 rounded hover:bg-gray-200">‚Üí</button>
                        </div>
                    </div>
                    <div id="calendar-container"></div>
                    <button onclick="ajouterEvenement()" class="btn-primary w-full mt-4">+ Nouvel √âv√©nement</button>
                </div>
                
                <!-- Routines -->
                <div class="card">
                    <h2 class="text-xl font-bold mb-4">üîÑ Routines</h2>
                    <div class="space-y-3 mb-4" id="routines-list">
                        ${renderRoutines()}
                    </div>
                    <button onclick="ajouterRoutine()" class="btn-primary w-full">+ Nouvelle Routine</button>
                </div>
            </div>
            
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Notes -->
                <div class="card">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl font-bold">üìù Notes</h2>
                        <button onclick="ajouterNote()" class="btn-primary">+ Nouvelle Note</button>
                    </div>
                    <div id="notes-list">
                        ${renderNotes()}
                    </div>
                </div>
                
                <!-- Pr√©f√©rences -->
                <div class="card">
                    <h2 class="text-xl font-bold mb-4">‚öôÔ∏è Pr√©f√©rences</h2>
                    ${renderPreferences()}
                </div>
            </div>
        </div>
    `;
}

function renderCalendar() {
    const container = document.getElementById('calendar-container');
    if (!container) return;
    
    const monthNames = ["Janvier", "F√©vrier", "Mars", "Avril", "Mai", "Juin", "Juillet", "Ao√ªt", "Septembre", "Octobre", "Novembre", "D√©cembre"];
    const titleEl = document.getElementById('calendar-title');
    if (titleEl) titleEl.textContent = `${monthNames[currentMonth]} ${currentYear}`;
    
    const firstDay = new Date(currentYear, currentMonth, 1).getDay();
    const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
    const today = new Date();
    
    let calendar = `
        <div class="calendar-grid">
            <div class="text-center font-semibold text-sm py-2">Dim</div>
            <div class="text-center font-semibold text-sm py-2">Lun</div>
            <div class="text-center font-semibold text-sm py-2">Mar</div>
            <div class="text-center font-semibold text-sm py-2">Mer</div>
            <div class="text-center font-semibold text-sm py-2">Jeu</div>
            <div class="text-center font-semibold text-sm py-2">Ven</div>
            <div class="text-center font-semibold text-sm py-2">Sam</div>
    `;
    
    const startDay = firstDay === 0 ? 6 : firstDay - 1;
    for (let i = 0; i < startDay; i++) {
        calendar += `<div class="calendar-day opacity-50"></div>`;
    }
    
    for (let day = 1; day <= daysInMonth; day++) {
        const date = new Date(currentYear, currentMonth, day);
        const dateStr = date.toISOString().split('T')[0];
        const isToday = today.toISOString().split('T')[0] === dateStr;
        const dayEvents = appData.personnel.events.filter(e => e.date === dateStr);
        
        calendar += `
            <div class="calendar-day ${isToday ? 'today' : ''}" onclick="showDayEvents('${dateStr}')">
                <div class="font-semibold mb-1">${day}</div>
                ${dayEvents.slice(0, 3).map(e => `
                    <div class="text-xs truncate mb-1">
                        <span class="event-dot" style="background: ${e.color || '#3B82F6'}"></span>
                        ${e.title}
                    </div>
                `).join('')}
                ${dayEvents.length > 3 ? `<div class="text-xs text-gray-500">+${dayEvents.length - 3}</div>` : ''}
            </div>
        `;
    }
    
    calendar += `</div>`;
    container.innerHTML = calendar;
}

function previousMonth() {
    currentMonth--;
    if (currentMonth < 0) {
        currentMonth = 11;
        currentYear--;
    }
    renderCalendar();
}

function nextMonth() {
    currentMonth++;
    if (currentMonth > 11) {
        currentMonth = 0;
        currentYear++;
    }
    renderCalendar();
}

function showDayEvents(date) {
    const events = appData.personnel.events.filter(e => e.date === date);
    openModal(`√âv√©nements du ${formatDate(date)}`, `
        <div class="space-y-3">
            ${events.length === 0 ? `
                <p class="text-gray-500 text-center py-4">Aucun √©v√©nement ce jour</p>
            ` : events.map(event => {
                const wakeTime = calculateWakeUpTime(event);
                return `
                    <div class="p-3 border-2 rounded-lg" style="border-left: 4px solid ${event.color || '#3B82F6'}">
                        <h3 class="font-bold">${event.title}</h3>
                        ${event.time ? `<p class="text-sm text-gray-600">üïê ${event.time}</p>` : ''}
                        ${wakeTime ? `<p class="text-sm text-blue-600">‚è∞ R√©veil sugg√©r√©: ${wakeTime}</p>` : ''}
                        ${event.description ? `<p class="text-sm mt-2">${event.description}</p>` : ''}
                    </div>
                `;
            }).join('')}
        </div>
        <button onclick="closeModal(); ajouterEvenement('${date}')" class="btn-primary w-full mt-4">+ Ajouter √©v√©nement</button>
    `);
}

function ajouterEvenement(defaultDate = null) {
    openModal('Nouvel √âv√©nement', `
        <form onsubmit="saveEvenement(event)" class="space-y-4">
            <div>
                <label class="block text-sm font-medium mb-2">Titre *</label>
                <input type="text" name="title" required placeholder="Ex: Cours BTS Banque">
            </div>
            <div>
                <label class="block text-sm font-medium mb-2">Date *</label>
                <input type="date" name="date" required value="${defaultDate || new Date().toISOString().split('T')[0]}">
            </div>
            <div>
                <label class="block text-sm font-medium mb-2">Heure</label>
                <input type="time" name="time">
            </div>
            <div>
                <label class="block text-sm font-medium mb-2">Description</label>
                <textarea name="description" rows="3"></textarea>
            </div>
            <div>
                <label class="block text-sm font-medium mb-2">Couleur</label>
                <div class="flex gap-2">
                    <button type="button" onclick="selectColor(this, '#3B82F6')" class="w-8 h-8 rounded-full" style="background: #3B82F6; border: 3px solid #3B82F6"></button>
                    <button type="button" onclick="selectColor(this, '#F97316')" class="w-8 h-8 rounded-full" style="background: #F97316; border: 3px solid transparent"></button>
                    <button type="button" onclick="selectColor(this, '#10B981')" class="w-8 h-8 rounded-full" style="background: #10B981; border: 3px solid transparent"></button>
                    <button type="button" onclick="selectColor(this, '#8B5CF6')" class="w-8 h-8 rounded-full" style="background: #8B5CF6; border: 3px solid transparent"></button>
                </div>
                <input type="hidden" name="color" value="#3B82F6">
            </div>
            <button type="submit" class="btn-primary w-full">Ajouter</button>
        </form>
    `);
}

function selectColor(btn, color) {
    document.querySelectorAll('button[onclick^="selectColor"]').forEach(b => b.style.border = '3px solid transparent');
    btn.style.border = `3px solid ${color}`;
    document.querySelector('input[name="color"]').value = color;
}

function saveEvenement(e) {
    e.preventDefault();
    const form = e.target;
    const event = {
        id: Date.now(),
        title: form.title.value,
        date: form.date.value,
        time: form.time.value,
        description: form.description.value,
        color: form.color.value,
        createdAt: new Date().toISOString()
    };
    
    appData.personnel.events.push(event);
    
    if (event.time) {
        const wakeTime = calculateWakeUpTime(event);
        if (wakeTime) {
            addInterconnection('personnel_event_' + event.id, 'personnel_wake_up', 'event_wake_up', {
                eventId: event.id,
                wakeTime: wakeTime
            });
        }
    }
    
    saveData(appData);
    closeModal();
    showSection('personnel');
    showToast('√âv√©nement ajout√© !', 'success');
}

function renderRoutines() {
    if (appData.personnel.routines.length === 0) {
        return `<p class="text-gray-400 text-center py-4">Aucune routine</p>`;
    }
    
    return appData.personnel.routines.map((routine, idx) => `
        <div class="p-3 bg-gray-50 rounded-lg">
            <div class="flex items-center justify-between mb-2">
                <div class="flex items-center gap-2">
                    <input type="checkbox" ${routine.completed ? 'checked' : ''} 
                        onchange="toggleRoutine(${idx})" 
                        class="w-5 h-5 text-blue-600 rounded">
                    <span class="font-semibold ${routine.completed ? 'line-through text-gray-400' : ''}">${routine.title}</span>
                </div>
                <button onclick="supprimerRoutine(${idx})" class="text-red-500">üóëÔ∏è</button>
            </div>
            <p class="text-sm text-gray-600">${routine.type === 'morning' ? 'üåÖ Matin' : routine.type === 'evening' ? 'üåô Soir' : 'üìÖ Quotidienne'}</p>
        </div>
    `).join('');
}

function ajouterRoutine() {
    openModal('Nouvelle Routine', `
        <form onsubmit="saveRoutine(event)" class="space-y-4">
            <div>
                <label class="block text-sm font-medium mb-2">Titre *</label>
                <input type="text" name="title" required placeholder="Ex: M√©ditation">
            </div>
            <div>
                <label class="block text-sm font-medium mb-2">Type *</label>
                <select name="type" required>
                    <option value="morning">Matin</option>
                    <option value="evening">Soir</option>
                    <option value="daily">Quotidienne</option>
                </select>
            </div>
            <button type="submit" class="btn-primary w-full">Ajouter</button>
        </form>
    `);
}

function saveRoutine(e) {
    e.preventDefault();
    const form = e.target;
    appData.personnel.routines.push({
        title: form.title.value,
        type: form.type.value,
        completed: false,
        createdAt: new Date().toISOString()
    });
    saveData(appData);
    closeModal();
    showSection('personnel');
    showToast('Routine ajout√©e !', 'success');
}

function toggleRoutine(index) {
    appData.personnel.routines[index].completed = !appData.personnel.routines[index].completed;
    saveData(appData);
    showSection('personnel');
}

function supprimerRoutine(index) {
    if (confirm('Supprimer cette routine ?')) {
        appData.personnel.routines.splice(index, 1);
        saveData(appData);
        showSection('personnel');
    }
}

function renderNotes() {
    if (appData.personnel.notes.length === 0) {
        return `<p class="text-gray-400 text-center py-8">Aucune note</p>`;
    }
    
    return `
        <div class="space-y-3 max-h-96 overflow-y-auto">
            ${appData.personnel.notes.slice().reverse().map((note, idx) => `
                <div class="p-3 bg-gray-50 rounded-lg">
                    <div class="flex justify-between items-start mb-2">
                        <h3 class="font-semibold">${note.title}</h3>
                        <button onclick="supprimerNote(${appData.personnel.notes.length - 1 - idx})" class="text-red-500">üóëÔ∏è</button>
                    </div>
                    <p class="text-sm text-gray-700 whitespace-pre-wrap">${note.content}</p>
                    <p class="text-xs text-gray-500 mt-2">${formatDate(note.createdAt)}</p>
                </div>
            `).join('')}
        </div>
    `;
}

function ajouterNote() {
    openModal('Nouvelle Note', `
        <form onsubmit="saveNote(event)" class="space-y-4">
            <div>
                <label class="block text-sm font-medium mb-2">Titre *</label>
                <input type="text" name="title" required placeholder="Ex: Id√©es pour projet">
            </div>
            <div>
                <label class="block text-sm font-medium mb-2">Contenu *</label>
                <textarea name="content" rows="6" required placeholder="Votre note..."></textarea>
            </div>
            <button type="submit" class="btn-primary w-full">Enregistrer</button>
        </form>
    `);
}

function saveNote(e) {
    e.preventDefault();
    const form = e.target;
    appData.personnel.notes.push({
        title: form.title.value,
        content: form.content.value,
        createdAt: new Date().toISOString()
    });
    saveData(appData);
    closeModal();
    showSection('personnel');
    showToast('Note enregistr√©e !', 'success');
}

function supprimerNote(index) {
    if (confirm('Supprimer cette note ?')) {
        appData.personnel.notes.splice(index, 1);
        saveData(appData);
        showSection('personnel');
    }
}

function renderPreferences() {
    return `
        <form onsubmit="savePreferences(event)" class="space-y-4">
            <div>
                <label class="block text-sm font-medium mb-2">Temps de pr√©paration (minutes)</label>
                <input type="number" name="preparationTime" value="${appData.preferences.preparationTime || 60}" min="1">
                <p class="text-xs text-gray-500 mt-1">Temps avant un √©v√©nement pour se pr√©parer</p>
            </div>
            <div>
                <label class="block text-sm font-medium mb-2">Objectif sommeil (heures)</label>
                <input type="number" name="sleepGoal" value="${appData.preferences.sleepGoal || 7.5}" step="0.5" min="1">
            </div>
            <button type="submit" class="btn-primary w-full">Enregistrer</button>
        </form>
    `;
}

function savePreferences(e) {
    e.preventDefault();
    const form = e.target;
    appData.preferences.preparationTime = parseInt(form.preparationTime.value);
    appData.preferences.sleepGoal = parseFloat(form.sleepGoal.value);
    saveData(appData);
    showToast('Pr√©f√©rences enregistr√©es !', 'success');
}

// ========================================
// SECTION PROJETS
// ========================================

function renderProjets() {
    const projetsActifs = appData.projets.projets.filter(p => p.status !== 'completed');
    const projetsTermines = appData.projets.projets.filter(p => p.status === 'completed');
    
    return `
        <div>
            <div class="flex justify-between items-center mb-6">
                <h1 class="text-3xl font-bold">üöÄ Projets</h1>
                <button onclick="ajouterProjet()" class="btn-primary">+ Nouveau Projet</button>
            </div>
            
            <!-- R√®gle des 3P -->
            <div class="card mb-6">
                <h2 class="text-xl font-bold mb-4">La R√®gle des 3P</h2>
                <p class="text-sm text-gray-600 mb-4">Un projet peut appartenir √† plusieurs cat√©gories</p>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="p-4 bg-gradient-to-br from-blue-50 to-blue-100 rounded-lg">
                        <div class="text-3xl mb-2">üë§</div>
                        <h3 class="font-bold mb-2">Personnel</h3>
                        <p class="text-sm text-gray-700">Mariage, enfants, passions, hobbies, animaux</p>
                        <p class="text-2xl font-bold mt-2">${appData.projets.projets.filter(p => p.categories.includes('Personnel')).length}</p>
                    </div>
                    <div class="p-4 bg-gradient-to-br from-orange-50 to-orange-100 rounded-lg">
                        <div class="text-3xl mb-2">üíº</div>
                        <h3 class="font-bold mb-2">Professionnel</h3>
                        <p class="text-sm text-gray-700">Carri√®re, formations, dipl√¥mes</p>
                        <p class="text-2xl font-bold mt-2">${appData.projets.projets.filter(p => p.categories.includes('Professionnel')).length}</p>
                    </div>
                    <div class="p-4 bg-gradient-to-br from-green-50 to-green-100 rounded-lg">
                        <div class="text-3xl mb-2">üí∞</div>
                        <h3 class="font-bold mb-2">Patrimoine</h3>
                        <p class="text-sm text-gray-700">Maison, voiture, placements</p>
                        <p class="text-2xl font-bold mt-2">${appData.projets.projets.filter(p => p.categories.includes('Patrimoine')).length}</p>
                    </div>
                </div>
            </div>
            
            <!-- Chemin de Vie -->
            <div class="card mb-6">
                <h2 class="text-xl font-bold mb-4">üõ§Ô∏è Chemin de Vie (22 ans)</h2>
                ${renderCheminDeVie()}
            </div>
            
            <!-- Projets Actifs -->
            <div class="card mb-6">
                <h2 class="text-xl font-bold mb-4">Projets Actifs (${projetsActifs.length})</h2>
                ${projetsActifs.length === 0 ? `
                    <p class="text-gray-400 text-center py-8">Aucun projet actif</p>
                ` : `
                    <div class="space-y-4">
                        ${projetsActifs.map(projet => renderProjetCard(projet)).join('')}
                    </div>
                `}
            </div>
            
            <!-- Projets Termin√©s -->
            ${projetsTermines.length > 0 ? `
                <div class="card">
                    <h2 class="text-xl font-bold mb-4">‚úÖ Projets Termin√©s (${projetsTermines.length})</h2>
                    <div class="space-y-3">
                        ${projetsTermines.map(projet => `
                            <div class="p-3 bg-green-50 border border-green-200 rounded-lg">
                                <h3 class="font-bold text-green-800">${projet.nom}</h3>
                                <p class="text-sm text-gray-600">${projet.categories.join(' ‚Ä¢ ')}</p>
                            </div>
                        `).join('')}
                    </div>
                </div>
            ` : ''}
        </div>
    `;
}

function renderCheminDeVie() {
    const suggestions = [
        { id: 'diplome_bts', title: 'Obtenir le dipl√¥me BTS Banque', categories: ['Professionnel'], priority: 'high' },
        { id: 'permis_conduire', title: 'Passer le permis de conduire', categories: ['Personnel'], priority: 'medium' },
        { id: 'premiere_voiture', title: 'Acheter premi√®re voiture', categories: ['Personnel', 'Patrimoine'], priority: 'medium' },
        { id: 'epargne_securite', title: 'Constituer √©pargne de s√©curit√©', categories: ['Patrimoine'], priority: 'high' },
        { id: 'premier_investissement', title: 'Premier investissement boursier', categories: ['Patrimoine'], priority: 'low' }
    ].filter(s => !appData.projets.rejectedSuggestions.includes(s.id));
    
    if (suggestions.length === 0) {
        return `<p class="text-gray-500">Aucune suggestion pour le moment. Continuez votre chemin ! üåü</p>`;
    }
    
    return `
        <div class="space-y-3">
            <p class="text-sm text-gray-600 mb-4">Suggestions adapt√©es √† votre √¢ge :</p>
            ${suggestions.map(suggestion => `
                <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                    <div class="flex-1">
                        <div class="flex items-center gap-2 mb-1">
                            <h3 class="font-semibold">${suggestion.title}</h3>
                            ${suggestion.priority === 'high' ? '<span class="badge badge-danger text-xs">Prioritaire</span>' : ''}
                        </div>
                        <div class="flex gap-2 mt-2">
                            ${suggestion.categories.map(cat => {
                                const colors = { 'Personnel': 'badge-info', 'Professionnel': 'badge-warning', 'Patrimoine': 'badge-success' };
                                return `<span class="badge ${colors[cat]}">${cat}</span>`;
                            }).join('')}
                        </div>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="accepterSuggestion('${suggestion.id}', '${suggestion.title}', ${JSON.stringify(suggestion.categories).replace(/"/g, '&quot;')})" 
                            class="text-green-600 hover:text-green-700 text-2xl">‚úì</button>
                        <button onclick="refuserSuggestion('${suggestion.id}')" 
                            class="text-red-500 hover:text-red-700 text-2xl">‚úó</button>
                    </div>
                </div>
            `).join('')}
        </div>
    `;
}

function renderProjetCard(projet) {
    const projetIndex = appData.projets.projets.indexOf(projet);
    return `
        <div class="p-4 border-2 border-gray-200 rounded-lg">
            <div class="flex justify-between items-start mb-3">
                <div class="flex-1">
                    <h3 class="font-bold text-lg mb-2">${projet.nom}</h3>
                    <div class="flex gap-2 mb-2">
                        ${projet.categories.map(cat => {
                            const colors = { 'Personnel': 'badge-info', 'Professionnel': 'badge-warning', 'Patrimoine': 'badge-success' };
                            return `<span class="badge ${colors[cat]}">${cat}</span>`;
                        }).join('')}
                    </div>
                    ${projet.description ? `<p class="text-sm text-gray-600 mt-2">${projet.description}</p>` : ''}
                    ${projet.coutEstime ? `
                        <div class="mt-3 p-2 bg-blue-50 rounded flex justify-between items-center">
                            <span class="text-sm text-gray-700">üí∞ Co√ªt estim√©:</span>
                            <span class="font-bold text-blue-700">${formatEuro(projet.coutEstime)}</span>
                        </div>
                    ` : ''}
                    ${projet.categories.includes('Patrimoine') ? '<span class="badge badge-link mt-2">üîó Li√© au Budget</span>' : ''}
                </div>
                <button onclick="supprimerProjet(${projetIndex})" class="text-red-500 ml-4">üóëÔ∏è</button>
            </div>
            <div class="mt-3">
                <div class="flex justify-between text-sm mb-1">
                    <span>Progression</span>
                    <span>${projet.progression || 0}%</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: ${projet.progression || 0}%"></div>
                </div>
                <input type="range" min="0" max="100" value="${projet.progression || 0}" 
                    onchange="updateProjetProgress(${projetIndex}, this.value)"
                    class="w-full mt-2 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
            </div>
            ${projet.progression === 100 ? `
                <button onclick="completerProjet(${projetIndex})" class="btn-primary w-full mt-3">Marquer comme termin√© ‚úì</button>
            ` : ''}
        </div>
    `;
}

function ajouterProjet() {
    openModal('Nouveau Projet', `
        <form onsubmit="saveProjet(event)" class="space-y-4">
            <div>
                <label class="block text-sm font-medium mb-2">Nom du projet *</label>
                <input type="text" name="nom" required placeholder="Ex: Acheter une maison">
            </div>
            <div>
                <label class="block text-sm font-medium mb-2">Cat√©gories * (plusieurs possibles)</label>
                <div class="space-y-2">
                    <label class="flex items-center">
                        <input type="checkbox" name="categories" value="Personnel" class="mr-2">
                        <span>üë§ Personnel</span>
                    </label>
                    <label class="flex items-center">
                        <input type="checkbox" name="categories" value="Professionnel" class="mr-2">
                        <span>üíº Professionnel</span>
                    </label>
                    <label class="flex items-center">
                        <input type="checkbox" name="categories" value="Patrimoine" class="mr-2">
                        <span>üí∞ Patrimoine</span>
                    </label>
                </div>
            </div>
            <div>
                <label class="block text-sm font-medium mb-2">Description</label>
                <textarea name="description" rows="3"></textarea>
            </div>
            <div>
                <label class="block text-sm font-medium mb-2">Co√ªt estim√© (‚Ç¨)</label>
                <input type="number" name="coutEstime" step="0.01">
            </div>
            <button type="submit" class="btn-primary w-full">Cr√©er le projet</button>
        </form>
    `);
}

function saveProjet(e) {
    e.preventDefault();
    const form = e.target;
    const categories = Array.from(form.categories).filter(c => c.checked).map(c => c.value);
    
    if (categories.length === 0) {
        alert('S√©lectionnez au moins une cat√©gorie');
        return;
    }
    
    const projet = {
        id: Date.now(),
        nom: form.nom.value,
        categories: categories,
        description: form.description.value,
        coutEstime: form.coutEstime.value ? parseFloat(form.coutEstime.value) : null,
        progression: 0,
        status: 'active',
        createdAt: new Date().toISOString()
    };
    
    appData.projets.projets.push(projet);
    
    // Interconnexion auto si Patrimoine
    if (categories.includes('Patrimoine')) {
        addInterconnection('projets_' + projet.id, 'budget', 'projet_patrimoine', { projetId: projet.id });
    }
    
    saveData(appData);
    closeModal();
    showSection('projets');
    showToast('Projet cr√©√© !', 'success');
}

function accepterSuggestion(id, title, categories) {
    appData.projets.projets.push({
        id: Date.now(),
        nom: title,
        categories: categories,
        progression: 0,
        status: 'active',
        fromSuggestion: true,
        createdAt: new Date().toISOString()
    });
    
    if (categories.includes('Patrimoine')) {
        addInterconnection('projets_' + Date.now(), 'budget', 'projet_patrimoine', { suggestionId: id });
    }
    
    saveData(appData);
    showSection('projets');
    showToast('Projet ajout√© !', 'success');
}

function refuserSuggestion(id) {
    appData.projets.rejectedSuggestions.push(id);
    saveData(appData);
    showSection('projets');
}

function updateProjetProgress(index, progress) {
    appData.projets.projets[index].progression = parseInt(progress);
    saveData(appData);
    showSection('projets');
}

function completerProjet(index) {
    appData.projets.projets[index].status = 'completed';
    appData.projets.projets[index].completedAt = new Date().toISOString();
    saveData(appData);
    showSection('projets');
    showToast('Projet termin√© ! üéâ', 'success');
}

function supprimerProjet(index) {
    if (confirm('Supprimer ce projet ?')) {
        appData.projets.projets.splice(index, 1);
        saveData(appData);
        showSection('projets');
    }
}

// ========================================
// SECTION CONTACTS
// ========================================

function renderContacts() {
    const contacts = appData.contacts.contacts;
    const byType = {
        'Famille': contacts.filter(c => c.type === 'Famille'),
        'Amis': contacts.filter(c => c.type === 'Amis'),
        'Coll√®gues': contacts.filter(c => c.type === 'Coll√®gues'),
        'Autres': contacts.filter(c => c.type === 'Autres')
    };
    
    const prochainsAnniversaires = contacts
        .filter(c => c.anniversaire)
        .map(c => {
            const today = new Date();
            const bday = new Date(today.getFullYear(), new Date(c.anniversaire).getMonth(), new Date(c.anniversaire).getDate());
            if (bday < today) bday.setFullYear(today.getFullYear() + 1);
            return { ...c, daysUntil: Math.floor((bday - today) / (1000 * 60 * 60 * 24)) };
        })
        .sort((a, b) => a.daysUntil - b.daysUntil)
        .slice(0, 5);
    
    return `
        <div>
            <div class="flex justify-between items-center mb-6">
                <h1 class="text-3xl font-bold">üë• Contacts</h1>
                <button onclick="ajouterContact()" class="btn-primary">+ Nouveau Contact</button>
            </div>
            
            <!-- Prochains Anniversaires -->
            ${prochainsAnniversaires.length > 0 ? `
                <div class="card mb-6">
                    <h2 class="text-xl font-bold mb-4">üéÇ Prochains Anniversaires</h2>
                    <div class="space-y-2">
                        ${prochainsAnniversaires.map(c => `
                            <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                <div>
                                    <p class="font-semibold">${c.nom}</p>
                                    <p class="text-sm text-gray-600">${formatDate(c.anniversaire)}</p>
                                </div>
                                <span class="badge ${c.daysUntil <= 7 ? 'badge-danger' : 'badge-info'}">
                                    ${c.daysUntil === 0 ? "Aujourd'hui !" : c.daysUntil === 1 ? 'Demain' : `Dans ${c.daysUntil}j`}
                                </span>
                            </div>
                        `).join('')}
                    </div>
                </div>
            ` : ''}
            
            <!-- Contacts par Type -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                ${Object.entries(byType).map(([type, contactsList]) => `
                    <div class="card">
                        <h2 class="text-lg font-bold mb-4">${type} (${contactsList.length})</h2>
                        ${contactsList.length === 0 ? `
                            <p class="text-gray-400 text-center py-4">Aucun contact</p>
                        ` : `
                            <div class="space-y-2 max-h-96 overflow-y-auto">
                                ${contactsList.map((contact, idx) => `
                                    <div class="p-3 bg-gray-50 rounded-lg">
                                        <div class="flex justify-between items-start mb-2">
                                            <div>
                                                <h3 class="font-semibold">${contact.nom}</h3>
                                                ${contact.anniversaire ? `<p class="text-xs text-gray-500">üéÇ ${formatDate(contact.anniversaire)}</p>` : ''}
                                                ${contact.telephone ? `<p class="text-xs text-gray-600">üìû ${contact.telephone}</p>` : ''}
                                                ${contact.email ? `<p class="text-xs text-gray-600">üìß ${contact.email}</p>` : ''}
                                            </div>
                                            <button onclick="supprimerContact(${contacts.indexOf(contact)})" class="text-red-500">üóëÔ∏è</button>
                                        </div>
                                        ${contact.notes ? `<p class="text-xs text-gray-700 mt-2 italic">"${contact.notes}"</p>` : ''}
                                    </div>
                                `).join('')}
                            </div>
                        `}
                    </div>
                `).join('')}
            </div>
        </div>
    `;
}

function ajouterContact() {
    openModal('Nouveau Contact', `
        <form onsubmit="saveContact(event)" class="space-y-4">
            <div>
                <label class="block text-sm font-medium mb-2">Nom *</label>
                <input type="text" name="nom" required placeholder="Ex: Jean Dupont">
            </div>
            <div>
                <label class="block text-sm font-medium mb-2">Type *</label>
                <select name="type" required>
                    <option value="Famille">Famille</option>
                    <option value="Amis">Amis</option>
                    <option value="Coll√®gues">Coll√®gues</option>
                    <option value="Autres">Autres</option>
                </select>
            </div>
            <div>
                <label class="block text-sm font-medium mb-2">T√©l√©phone</label>
                <input type="tel" name="telephone" placeholder="Ex: 06 12 34 56 78">
            </div>
            <div>
                <label class="block text-sm font-medium mb-2">Email</label>
                <input type="email" name="email" placeholder="Ex: jean@email.com">
            </div>
            <div>
                <label class="block text-sm font-medium mb-2">Date anniversaire</label>
                <input type="date" name="anniversaire">
            </div>
            <div>
                <label class="block text-sm font-medium mb-2">Notes</label>
                <textarea name="notes" rows="3" placeholder="Centres d'int√©r√™t, cadeaux offerts, etc."></textarea>
            </div>
            <button type="submit" class="btn-primary w-full">Ajouter</button>
        </form>
    `);
}

function saveContact(e) {
    e.preventDefault();
    const form = e.target;
    const contact = {
        id: Date.now(),
        nom: form.nom.value,
        type: form.type.value,
        telephone: form.telephone.value,
        email: form.email.value,
        anniversaire: form.anniversaire.value,
        notes: form.notes.value,
        createdAt: new Date().toISOString()
    };
    
    appData.contacts.contacts.push(contact);
    
    // Interconnexion: anniversaire ‚Üí rappel
    if (contact.anniversaire) {
        addInterconnection('contacts_' + contact.id, 'personnel_event', 'contact_birthday', {
            contactId: contact.id,
            date: contact.anniversaire
        });
    }
    
    saveData(appData);
    closeModal();
    showSection('contacts');
    showToast('Contact ajout√© !', 'success');
}

function supprimerContact(index) {
    if (confirm('Supprimer ce contact ?')) {
        appData.contacts.contacts.splice(index, 1);
        saveData(appData);
        showSection('contacts');
    }
}

// ========================================
// SECTION ADMINISTRATIF
// ========================================

function renderAdmin() {
    const byCategory = {
        'Domicile': appData.admin.documents.filter(d => d.category === 'Domicile'),
        'Imp√¥ts': appData.admin.documents.filter(d => d.category === 'Imp√¥ts'),
        '√âv√©nements': appData.admin.documents.filter(d => d.category === '√âv√©nements'),
        'Autres': appData.admin.documents.filter(d => d.category === 'Autres' || !d.category)
    };
    
    return `
        <div>
            <div class="flex justify-between items-center mb-6">
                <h1 class="text-3xl font-bold">üìã Administratif</h1>
                <button onclick="uploaderDocument()" class="btn-primary">+ Upload Document</button>
            </div>
            
            <!-- Stats -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                ${Object.entries(byCategory).map(([cat, docs]) => `
                    <div class="card">
                        <p class="text-sm text-gray-600 mb-1">${cat}</p>
                        <p class="text-2xl font-bold">${docs.length}</p>
                    </div>
                `).join('')}
            </div>
            
            <!-- Documents par Cat√©gorie -->
            ${Object.entries(byCategory).map(([category, documents]) => `
                ${documents.length > 0 ? `
                    <div class="card mb-6">
                        <h2 class="text-xl font-bold mb-4">${category}</h2>
                        <div class="space-y-2">
                            ${documents.map((doc, idx) => `
                                <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                    <div class="flex items-center gap-3">
                                        <span class="text-2xl">üìÑ</span>
                                        <div>
                                            <p class="font-semibold">${doc.nom}</p>
                                            <p class="text-xs text-gray-500">Ajout√© le ${formatDate(doc.createdAt)}</p>
                                            ${doc.tags && doc.tags.length > 0 ? `
                                                <div class="flex gap-1 mt-1">
                                                    ${doc.tags.map(tag => `<span class="badge badge-info">${tag}</span>`).join('')}
                                                </div>
                                            ` : ''}
                                        </div>
                                    </div>
                                    <div class="flex gap-2">
                                        <button onclick="telechargerDocument(${appData.admin.documents.indexOf(doc)})" class="text-blue-600 hover:text-blue-700">üíæ</button>
                                        <button onclick="supprimerDocument(${appData.admin.documents.indexOf(doc)})" class="text-red-500 hover:text-red-700">üóëÔ∏è</button>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                ` : ''}
            `).join('')}
            
            ${appData.admin.documents.length === 0 ? `
                <div class="card">
                    <p class="text-gray-400 text-center py-12">
                        Aucun document. Cliquez sur "Upload Document" pour commencer.
                    </p>
                </div>
            ` : ''}
        </div>
    `;
}

function uploaderDocument() {
    openModal('Upload Document', `
        <form onsubmit="saveDocument(event)" class="space-y-4">
            <div>
                <label class="block text-sm font-medium mb-2">Fichier *</label>
                <input type="file" name="file" required accept=".pdf,.jpg,.jpeg,.png" class="w-full">
                <p class="text-xs text-gray-500 mt-1">PDF, JPG ou PNG uniquement</p>
            </div>
            <div>
                <label class="block text-sm font-medium mb-2">Nom du document *</label>
                <input type="text" name="nom" required placeholder="Ex: Justificatif de domicile">
            </div>
            <div>
                <label class="block text-sm font-medium mb-2">Cat√©gorie *</label>
                <select name="category" required>
                    <option value="Domicile">Justificatif Domicile</option>
                    <option value="Imp√¥ts">Feuilles d'Imposition</option>
                    <option value="√âv√©nements">Places √âv√©nements</option>
                    <option value="Autres">Autres</option>
                </select>
            </div>
            <div>
                <label class="block text-sm font-medium mb-2">Tags (s√©par√©s par des virgules)</label>
                <input type="text" name="tags" placeholder="Ex: 2024, important, √† renouveler">
            </div>
            <button type="submit" class="btn-primary w-full">Enregistrer</button>
        </form>
    `);
}

function saveDocument(e) {
    e.preventDefault();
    const form = e.target;
    const file = form.file.files[0];
    
    if (!file) return;
    
    const reader = new FileReader();
    reader.onload = function(event) {
        const document = {
            id: Date.now(),
            nom: form.nom.value,
            category: form.category.value,
            tags: form.tags.value ? form.tags.value.split(',').map(t => t.trim()) : [],
            fileData: event.target.result,
            fileName: file.name,
            fileType: file.type,
            fileSize: file.size,
            createdAt: new Date().toISOString()
        };
        
        appData.admin.documents.push(document);
        saveData(appData);
        closeModal();
        showSection('admin');
        showToast('Document enregistr√© !', 'success');
    };
    reader.readAsDataURL(file);
}

function telechargerDocument(index) {
    const doc = appData.admin.documents[index];
    const link = document.createElement('a');
    link.href = doc.fileData;
    link.download = doc.fileName;
    link.click();
    showToast('T√©l√©chargement lanc√©', 'success');
}

function supprimerDocument(index) {
    if (confirm('Supprimer ce document ?')) {
        appData.admin.documents.splice(index, 1);
        saveData(appData);
        showSection('admin');
    }
}

// ========================================
// SECTION LOISIRS
// ========================================

function renderLoisirs() {
    return `
        <div>
            <h1 class="text-3xl font-bold mb-6">üéÆ Loisirs</h1>
            
            <!-- Tabs -->
            <div class="flex gap-2 mb-6">
                <button onclick="showLoisirsTab('voyages')" id="loisirs-tab-voyages" class="btn-primary">‚úàÔ∏è Voyages</button>
                <button onclick="showLoisirsTab('livres')" id="loisirs-tab-livres" class="btn-secondary">üìö Lecture</button>
                <button onclick="showLoisirsTab('sport')" id="loisirs-tab-sport" class="btn-secondary">üèÉ Sport</button>
                <button onclick="showLoisirsTab('hobbies')" id="loisirs-tab-hobbies" class="btn-secondary">üé® Hobbies</button>
            </div>

            <div id="loisirs-tab-content"></div>
        </div>
    `;
}

let currentLoisirsTab = 'voyages';

function showLoisirsTab(tab) {
    currentLoisirsTab = tab;
    
    document.querySelectorAll('[id^="loisirs-tab-"]').forEach(btn => {
        btn.className = btn.id === 'loisirs-tab-' + tab ? 'btn-primary' : 'btn-secondary';
    });
    
    const content = document.getElementById('loisirs-tab-content');
    
    switch(tab) {
        case 'voyages':
            content.innerHTML = renderVoyagesTab();
            break;
        case 'livres':
            content.innerHTML = renderLivresTab();
            break;
        case 'sport':
            content.innerHTML = renderSportTab();
            break;
        case 'hobbies':
            content.innerHTML = renderHobbiesTab();
            break;
    }
}

function renderVoyagesTab() {
    const voyages = appData.loisirs.voyages;
    const futurs = voyages.filter(v => !v.completed);
    const passes = voyages.filter(v => v.completed);
    
    return `
        <div class="card mb-6">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold">Voyages √† Venir (${futurs.length})</h2>
                <button onclick="ajouterVoyage()" class="btn-primary">+ Nouveau Voyage</button>
            </div>
            ${futurs.length === 0 ? `
                <p class="text-gray-400 text-center py-8">Aucun voyage pr√©vu</p>
            ` : `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    ${futurs.map(voyage => renderVoyageCard(voyage)).join('')}
                </div>
            `}
        </div>
        
        ${passes.length > 0 ? `
            <div class="card">
                <h2 class="text-xl font-bold mb-4">‚úÖ Voyages Pass√©s (${passes.length})</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                    ${passes.map(v => `
                        <div class="p-3 bg-gray-50 rounded-lg">
                            <p class="font-semibold">${v.destination}</p>
                            <p class="text-sm text-gray-600">${formatDate(v.dateDepart)} ‚Üí ${formatDate(v.dateRetour)}</p>
                        </div>
                    `).join('')}
                </div>
            </div>
        ` : ''}
    `;
}

function renderVoyageCard(voyage) {
    const voyageIndex = appData.loisirs.voyages.indexOf(voyage);
    return `
        <div class="p-4 border-2 border-blue-200 rounded-lg bg-gradient-to-br from-blue-50 to-white">
            <div class="flex justify-between items-start mb-3">
                <div>
                    <h3 class="font-bold text-lg">‚úàÔ∏è ${voyage.destination}</h3>
                    <p class="text-sm text-gray-600">${formatDate(voyage.dateDepart)} ‚Üí ${formatDate(voyage.dateRetour)}</p>
                </div>
                <button onclick="supprimerVoyage(${voyageIndex})" class="text-red-500">üóëÔ∏è</button>
            </div>
            ${voyage.budget ? `
                <div class="p-2 bg-white rounded mb-2">
                    <p class="text-sm text-gray-700">üí∞ Budget: ${formatEuro(voyage.budget)}</p>
                    ${voyage.depenses ? `<p class="text-xs text-gray-600">D√©pens√©: ${formatEuro(voyage.depenses)}</p>` : ''}
                </div>
            ` : ''}
            <div class="flex gap-2 mt-3">
                <span class="badge badge-link">üîó √âv√©nement cr√©√©</span>
                ${voyage.budget ? '<span class="badge badge-link">üîó Li√© Budget</span>' : ''}
            </div>
            <button onclick="completerVoyage(${voyageIndex})" class="btn-primary w-full mt-3 text-sm">Marquer comme fait ‚úì</button>
        </div>
    `;
}

function ajouterVoyage() {
    openModal('Nouveau Voyage', `
        <form onsubmit="saveVoyage(event)" class="space-y-4">
            <div>
                <label class="block text-sm font-medium mb-2">Destination *</label>
                <input type="text" name="destination" required placeholder="Ex: Tokyo, Japon">
            </div>
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium mb-2">Date d√©part *</label>
                    <input type="date" name="dateDepart" required>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">Date retour *</label>
                    <input type="date" name="dateRetour" required>
                </div>
            </div>
            <div>
                <label class="block text-sm font-medium mb-2">Budget (‚Ç¨)</label>
                <input type="number" name="budget" step="0.01" placeholder="0.00">
            </div>
            <div>
                <label class="block text-sm font-medium mb-2">Notes</label>
                <textarea name="notes" rows="3" placeholder="Activit√©s pr√©vues, etc."></textarea>
            </div>
            <button type="submit" class="btn-primary w-full">Cr√©er le voyage</button>
        </form>
    `);
}

function saveVoyage(e) {
    e.preventDefault();
    const form = e.target;
    const voyage = {
        id: Date.now(),
        destination: form.destination.value,
        dateDepart: form.dateDepart.value,
        dateRetour: form.dateRetour.value,
        budget: form.budget.value ? parseFloat(form.budget.value) : null,
        notes: form.notes.value,
        depenses: 0,
        completed: false,
        createdAt: new Date().toISOString()
    };
    
    appData.loisirs.voyages.push(voyage);
    
    // INTERCONNEXION AUTO: Cr√©er √©v√©nement
    createEventForVoyage(voyage);
    
    saveData(appData);
    closeModal();
    showLoisirsTab('voyages');
    showToast('Voyage ajout√© ! √âv√©nement cr√©√© automatiquement.', 'success');
}

function createEventForVoyage(voyage) {
    const event = {
        id: Date.now(),
        title: `‚úàÔ∏è Voyage: ${voyage.destination}`,
        date: voyage.dateDepart,
        endDate: voyage.dateRetour,
        color: '#F97316',
        linkedVoyageId: voyage.id,
        createdAt: new Date().toISOString()
    };
    appData.personnel.events.push(event);
    addInterconnection('loisirs_voyage_' + voyage.id, 'personnel_event_' + event.id, 'voyage_to_event', { 
        voyageId: voyage.id, 
        eventId: event.id 
    });
}

function completerVoyage(index) {
    appData.loisirs.voyages[index].completed = true;
    saveData(appData);
    showLoisirsTab('voyages');
    showToast('Bon retour de voyage ! üåç', 'success');
}

function supprimerVoyage(index) {
    if (confirm('Supprimer ce voyage ?')) {
        appData.loisirs.voyages.splice(index, 1);
        saveData(appData);
        showLoisirsTab('voyages');
    }
}

function renderLivresTab() {
    const livres = appData.loisirs.livres;
    const lus = livres.filter(l => l.status === 'lu');
    const enCours = livres.filter(l => l.status === 'en_cours');
    const wishlist = livres.filter(l => l.status === 'wishlist');
    
    const objectif = 24; // 2 livres/mois
    const progression = Math.min(100, (lus.length / objectif) * 100);
    
    return `
        <div class="card mb-6">
            <h2 class="text-xl font-bold mb-4">üìä Objectif Lecture 2024</h2>
            <div class="flex items-center justify-between mb-3">
                <span class="text-lg font-semibold">${lus.length} / ${objectif} livres</span>
                <span class="badge badge-${progression >= 80 ? 'success' : 'info'}">${Math.round(progression)}%</span>
            </div>
            <div class="progress-bar mb-4" style="height: 12px">
                <div class="progress-fill" style="width: ${progression}%"></div>
            </div>
            <button onclick="ajouterLivre()" class="btn-primary w-full">+ Ajouter un livre</button>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <div class="card">
                <h3 class="font-bold mb-3">En cours (${enCours.length})</h3>
                ${enCours.length === 0 ? '<p class="text-gray-400 text-sm">Aucun</p>' : `
                    <div class="space-y-2">
                        ${enCours.map(l => renderLivreItem(l)).join('')}
                    </div>
                `}
            </div>
            
            <div class="card">
                <h3 class="font-bold mb-3">Wishlist (${wishlist.length})</h3>
                ${wishlist.length === 0 ? '<p class="text-gray-400 text-sm">Aucun</p>' : `
                    <div class="space-y-2">
                        ${wishlist.map(l => renderLivreItem(l)).join('')}
                    </div>
                `}
            </div>
            
            <div class="card">
                <h3 class="font-bold mb-3">Lus (${lus.length})</h3>
                ${lus.length === 0 ? '<p class="text-gray-400 text-sm">Aucun</p>' : `
                    <div class="space-y-2 max-h-96 overflow-y-auto">
                        ${lus.map(l => renderLivreItem(l)).join('')}
                    </div>
                `}
            </div>
        </div>
    `;
}

function renderLivreItem(livre) {
    const livreIndex = appData.loisirs.livres.indexOf(livre);
    return `
        <div class="p-2 bg-gray-50 rounded text-sm">
            <div class="flex justify-between items-start">
                <div class="flex-1">
                    <p class="font-semibold">${livre.titre}</p>
                    ${livre.auteur ? `<p class="text-xs text-gray-600">${livre.auteur}</p>` : ''}
                </div>
                <button onclick="supprimerLivre(${livreIndex})" class="text-red-500 text-xs">üóëÔ∏è</button>
            </div>
            ${livre.status !== 'lu' ? `
                <button onclick="marquerLu(${livreIndex})" class="text-xs text-green-600 mt-1">Marquer comme lu ‚úì</button>
            ` : ''}
        </div>
    `;
}

function ajouterLivre() {
    openModal('Ajouter un Livre', `
        <form onsubmit="saveLivre(event)" class="space-y-4">
            <div>
                <label class="block text-sm font-medium mb-2">Titre *</label>
                <input type="text" name="titre" required>
            </div>
            <div>
                <label class="block text-sm font-medium mb-2">Auteur</label>
                <input type="text" name="auteur">
            </div>
            <div>
                <label class="block text-sm font-medium mb-2">Statut *</label>
                <select name="status" required>
                    <option value="wishlist">√Ä lire</option>
                    <option value="en_cours">En cours</option>
                    <option value="lu">Lu</option>
                </select>
            </div>
            <button type="submit" class="btn-primary w-full">Ajouter</button>
        </form>
    `);
}

function saveLivre(e) {
    e.preventDefault();
    const form = e.target;
    appData.loisirs.livres.push({
        id: Date.now(),
        titre: form.titre.value,
        auteur: form.auteur.value,
        status: form.status.value,
        createdAt: new Date().toISOString()
    });
    saveData(appData);
    closeModal();
    showLoisirsTab('livres');
    showToast('Livre ajout√© !', 'success');
}

function marquerLu(index) {
    appData.loisirs.livres[index].status = 'lu';
    appData.loisirs.livres[index].dateFinish = new Date().toISOString();
    saveData(appData);
    showLoisirsTab('livres');
    showToast('Bravo ! üìö', 'success');
}

function supprimerLivre(index) {
    if (confirm('Supprimer ce livre ?')) {
        appData.loisirs.livres.splice(index, 1);
        saveData(appData);
        showLoisirsTab('livres');
    }
}

function renderSportTab() {
    const sports = appData.loisirs.sports;
    const thisWeek = sports.filter(s => {
        const date = new Date(s.date);
        const weekAgo = new Date();
        weekAgo.setDate(weekAgo.getDate() - 7);
        return date >= weekAgo;
    }).length;
    
    const objectif = 3;
    const progression = Math.min(100, (thisWeek / objectif) * 100);
    
    return `
        <div class="card mb-6">
            <h2 class="text-xl font-bold mb-4">üéØ Objectif: 3 s√©ances/semaine</h2>
            <div class="flex items-center justify-between mb-3">
                <span class="text-lg font-semibold">Cette semaine: ${thisWeek} / ${objectif}</span>
                <span class="badge badge-${progression >= 100 ? 'success' : 'warning'}">${Math.round(progression)}%</span>
            </div>
            <div class="progress-bar mb-4" style="height: 12px">
                <div class="progress-fill" style="width: ${progression}%"></div>
            </div>
            <button onclick="ajouterSeanceSport()" class="btn-primary w-full">+ Ajouter s√©ance</button>
        </div>
        
        <div class="card">
            <h3 class="font-bold mb-4">Historique (${sports.length} s√©ances)</h3>
            ${sports.length === 0 ? `
                <p class="text-gray-400 text-center py-8">Aucune s√©ance enregistr√©e</p>
            ` : `
                <div class="space-y-2 max-h-96 overflow-y-auto">
                    ${sports.slice().reverse().slice(0, 20).map((s, idx) => `
                        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                            <div>
                                <p class="font-semibold">${s.type}</p>
                                <p class="text-sm text-gray-600">${formatDate(s.date)} ‚Ä¢ ${s.duree} min</p>
                            </div>
                            <button onclick="supprimerSeance(${sports.length - 1 - idx})" class="text-red-500">üóëÔ∏è</button>
                        </div>
                    `).join('')}
                </div>
            `}
        </div>
    `;
}

function ajouterSeanceSport() {
    openModal('Nouvelle S√©ance Sport', `
        <form onsubmit="saveSeanceSport(event)" class="space-y-4">
            <div>
                <label class="block text-sm font-medium mb-2">Type *</label>
                <select name="type" required>
                    <option value="Musculation">Musculation</option>
                    <option value="Course">Course</option>
                    <option value="V√©lo">V√©lo</option>
                    <option value="Natation">Natation</option>
                    <option value="Yoga">Yoga</option>
                    <option value="Autre">Autre</option>
                </select>
            </div>
            <div>
                <label class="block text-sm font-medium mb-2">Date *</label>
                <input type="date" name="date" required value="${new Date().toISOString().split('T')[0]}">
            </div>
            <div>
                <label class="block text-sm font-medium mb-2">Dur√©e (minutes) *</label>
                <input type="number" name="duree" required min="1" placeholder="60">
            </div>
            <button type="submit" class="btn-primary w-full">Enregistrer</button>
        </form>
    `);
}

function saveSeanceSport(e) {
    e.preventDefault();
    const form = e.target;
    appData.loisirs.sports.push({
        id: Date.now(),
        type: form.type.value,
        date: form.date.value,
        duree: parseInt(form.duree.value),
        createdAt: new Date().toISOString()
    });
    saveData(appData);
    closeModal();
    showLoisirsTab('sport');
    showToast('S√©ance enregistr√©e ! üí™', 'success');
}

function supprimerSeance(index) {
    appData.loisirs.sports.splice(index, 1);
    saveData(appData);
    showLoisirsTab('sport');
}

function renderHobbiesTab() {
    return `
        <div class="card">
            <h2 class="text-xl font-bold mb-4">üé® Autres Hobbies</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="p-4 bg-gray-50 rounded-lg">
                    <h3 class="font-bold mb-2">üç≥ Cuisine / Cocktails</h3>
                    <p class="text-sm text-gray-600 mb-3">Recettes test√©es et √† essayer</p>
                    <button onclick="ajouterHobby('cuisine')" class="btn-primary w-full">+ Ajouter recette</button>
                </div>
                <div class="p-4 bg-gray-50 rounded-lg">
                    <h3 class="font-bold mb-2">üé¨ Films & S√©ries</h3>
                    <p class="text-sm text-gray-600 mb-3">Liste de visionnage</p>
                    <button onclick="ajouterHobby('films')" class="btn-primary w-full">+ Ajouter</button>
                </div>
                <div class="p-4 bg-gray-50 rounded-lg">
                    <h3 class="font-bold mb-2">üéµ Musique</h3>
                    <p class="text-sm text-gray-600 mb-3">Albums et concerts</p>
                    <button onclick="ajouterHobby('musique')" class="btn-primary w-full">+ Ajouter</button>
                </div>
                <div class="p-4 bg-gray-50 rounded-lg">
                    <h3 class="font-bold mb-2">üéÆ Jeux Vid√©o</h3>
                    <p class="text-sm text-gray-600 mb-3">Backlog et termin√©s</p>
                    <button onclick="ajouterHobby('jeux')" class="btn-primary w-full">+ Ajouter</button>
                </div>
            </div>
        </div>
    `;
}

function ajouterHobby(type) {
    showToast('Fonctionnalit√© en d√©veloppement !', 'info');
}

// ========================================
// SECTION SANT√â
// ========================================

function renderSante() {
    const scoreSante = calculateScoreSante();
    
    return `
        <div>
            <h1 class="text-3xl font-bold mb-6">üè• Sant√©</h1>
            
            <!-- Score Sant√© Global -->
            <div class="card mb-6">
                <h2 class="text-xl font-bold mb-4">üìä Score Sant√© Global</h2>
                <div class="flex items-center justify-center mb-4">
                    <div class="text-center">
                        <div class="text-6xl font-bold ${scoreSante >= 75 ? 'text-green-600' : scoreSante >= 50 ? 'text-orange-600' : 'text-red-600'} mb-2">
                            ${scoreSante}%
                        </div>
                        <p class="text-gray-600">
                            ${scoreSante >= 75 ? 'Excellent ! üåü' : scoreSante >= 50 ? 'Bien, peut mieux faire üëç' : '√Ä am√©liorer üí™'}
                        </p>
                    </div>
                </div>
                <div class="progress-bar" style="height: 16px">
                    <div class="progress-fill" style="width: ${scoreSante}%"></div>
                </div>
                <p class="text-xs text-gray-500 text-center mt-2">Bas√© sur: Sommeil (40%), Sport (40%), RDV Sant√© (20%)</p>
            </div>
            
            <!-- Tabs -->
            <div class="flex gap-2 mb-6">
                <button onclick="showSanteTab('sommeil')" id="sante-tab-sommeil" class="btn-primary">üò¥ Sommeil</button>
                <button onclick="showSanteTab('rdv')" id="sante-tab-rdv" class="btn-secondary">üìÖ RDV M√©dicaux</button>
                <button onclick="showSanteTab('stats')" id="sante-tab-stats" class="btn-secondary">üìä Statistiques</button>
            </div>

            <div id="sante-tab-content"></div>
        </div>
    `;
}

let currentSanteTab = 'sommeil';

function showSanteTab(tab) {
    currentSanteTab = tab;
    
    document.querySelectorAll('[id^="sante-tab-"]').forEach(btn => {
        btn.className = btn.id === 'sante-tab-' + tab ? 'btn-primary' : 'btn-secondary';
    });
    
    const content = document.getElementById('sante-tab-content');
    
    switch(tab) {
        case 'sommeil':
            content.innerHTML = renderSommeilTab();
            break;
        case 'rdv':
            content.innerHTML = renderRDVTab();
            break;
        case 'stats':
            content.innerHTML = renderStatsTab();
            break;
    }
}

function renderSommeilTab() {
    const sommeil = appData.sante.sommeil;
    const recent7 = sommeil.slice(-7);
    const avgSommeil = recent7.length > 0 ? (recent7.reduce((sum, s) => sum + s.heures, 0) / recent7.length).toFixed(1) : 0;
    const objectif = appData.preferences.sleepGoal || 7.5;
    
    return `
        <div class="card mb-6">
            <h2 class="text-xl font-bold mb-4">üò¥ Suivi Sommeil</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                <div class="stat-card" style="background: linear-gradient(135deg, #8B5CF6 0%, #6366F1 100%);">
                    <p class="text-sm opacity-90 mb-1">Moyenne 7 derniers jours</p>
                    <p class="text-2xl font-bold">${avgSommeil}h</p>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #10B981 0%, #059669 100%);">
                    <p class="text-sm opacity-90 mb-1">Objectif</p>
                    <p class="text-2xl font-bold">${objectif}h</p>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #3B82F6 0%, #2563EB 100%);">
                    <p class="text-sm opacity-90 mb-1">Total nuits</p>
                    <p class="text-2xl font-bold">${sommeil.length}</p>
                </div>
            </div>
            <button onclick="ajouterSommeil()" class="btn-primary w-full">+ Ajouter nuit</button>
        </div>
        
        <div class="card">
            <h3 class="font-bold mb-4">Historique (${sommeil.length} nuits)</h3>
            ${sommeil.length === 0 ? `
                <p class="text-gray-400 text-center py-8">Aucune donn√©e de sommeil</p>
            ` : `
                <div class="space-y-2 max-h-96 overflow-y-auto">
                    ${sommeil.slice().reverse().slice(0, 30).map((s, idx) => {
                        const isGood = s.heures >= objectif;
                        return `
                            <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                <div class="flex items-center gap-3">
                                    <span class="text-2xl">${isGood ? 'üò¥' : 'üò™'}</span>
                                    <div>
                                        <p class="font-semibold">${s.heures}h de sommeil</p>
                                        <p class="text-sm text-gray-600">${formatDate(s.date)}</p>
                                    </div>
                                </div>
                                <div class="flex items-center gap-2">
                                    <span class="badge badge-${isGood ? 'success' : 'warning'}">${isGood ? 'Objectif atteint' : 'Insuffisant'}</span>
                                    <button onclick="supprimerSommeil(${sommeil.length - 1 - idx})" class="text-red-500">üóëÔ∏è</button>
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
            `}
        </div>
    `;
}

function ajouterSommeil() {
    openModal('Ajouter Sommeil', `
        <form onsubmit="saveSommeil(event)" class="space-y-4">
            <div>
                <label class="block text-sm font-medium mb-2">Date *</label>
                <input type="date" name="date" required value="${new Date().toISOString().split('T')[0]}">
            </div>
            <div>
                <label class="block text-sm font-medium mb-2">Heures de sommeil *</label>
                <input type="number" name="heures" required step="0.5" min="0" max="24" placeholder="7.5">
            </div>
            <div>
                <label class="block text-sm font-medium mb-2">Qualit√© (1-5)</label>
                <select name="qualite">
                    <option value="">-- Non sp√©cifi√© --</option>
                    <option value="5">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê Excellente</option>
                    <option value="4">‚≠ê‚≠ê‚≠ê‚≠ê Bonne</option>
                    <option value="3">‚≠ê‚≠ê‚≠ê Moyenne</option>
                    <option value="2">‚≠ê‚≠ê Mauvaise</option>
                    <option value="1">‚≠ê Tr√®s mauvaise</option>
                </select>
            </div>
            <button type="submit" class="btn-primary w-full">Enregistrer</button>
        </form>
    `);
}

function saveSommeil(e) {
    e.preventDefault();
    const form = e.target;
    appData.sante.sommeil.push({
        id: Date.now(),
        date: form.date.value,
        heures: parseFloat(form.heures.value),
        qualite: form.qualite.value ? parseInt(form.qualite.value) : null,
        createdAt: new Date().toISOString()
    });
    saveData(appData);
    closeModal();
    showSanteTab('sommeil');
    showToast('Sommeil enregistr√© !', 'success');
}

function supprimerSommeil(index) {
    appData.sante.sommeil.splice(index, 1);
    saveData(appData);
    showSanteTab('sommeil');
}

function renderRDVTab() {
    const rdv = appData.sante.rdv;
    const futurs = rdv.filter(r => new Date(r.date) >= new Date()).sort((a, b) => new Date(a.date) - new Date(b.date));
    const passes = rdv.filter(r => new Date(r.date) < new Date()).sort((a, b) => new Date(b.date) - new Date(a.date));
    
    return `
        <div class="card mb-6">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold">üìÖ Prochains RDV (${futurs.length})</h2>
                <button onclick="ajouterRDV()" class="btn-primary">+ Nouveau RDV</button>
            </div>
            ${futurs.length === 0 ? `
                <p class="text-gray-400 text-center py-8">Aucun RDV √† venir</p>
            ` : `
                <div class="space-y-3">
                    ${futurs.map((r, idx) => `
                        <div class="p-4 border-2 border-blue-200 rounded-lg bg-blue-50">
                            <div class="flex justify-between items-start mb-2">
                                <div>
                                    <h3 class="font-bold">${r.type}</h3>
                                    <p class="text-sm text-gray-700">${r.praticien || 'Praticien non sp√©cifi√©'}</p>
                                    <p class="text-sm text-gray-600 mt-1">üìÖ ${formatDate(r.date)} ${r.heure ? `√† ${r.heure}` : ''}</p>
                                </div>
                                <button onclick="supprimerRDV(${rdv.indexOf(r)})" class="text-red-500">üóëÔ∏è</button>
                            </div>
                            ${r.notes ? `<p class="text-sm text-gray-700 mt-2 italic">"${r.notes}"</p>` : ''}
                        </div>
                    `).join('')}
                </div>
            `}
        </div>
        
        ${passes.length > 0 ? `
            <div class="card">
                <h3 class="font-bold mb-4">Historique RDV (${passes.length})</h3>
                <div class="space-y-2 max-h-64 overflow-y-auto">
                    ${passes.map(r => `
                        <div class="p-3 bg-gray-50 rounded-lg">
                            <p class="font-semibold text-sm">${r.type}</p>
                            <p class="text-xs text-gray-600">${formatDate(r.date)} ‚Ä¢ ${r.praticien || ''}</p>
                        </div>
                    `).join('')}
                </div>
            </div>
        ` : ''}
    `;
}

function ajouterRDV() {
    openModal('Nouveau RDV M√©dical', `
        <form onsubmit="saveRDV(event)" class="space-y-4">
            <div>
                <label class="block text-sm font-medium mb-2">Type *</label>
                <select name="type" required>
                    <option value="M√©decin g√©n√©raliste">M√©decin g√©n√©raliste</option>
                    <option value="Dentiste">Dentiste</option>
                    <option value="Ophtalmologue">Ophtalmologue</option>
                    <option value="Cardiologue">Cardiologue</option>
                    <option value="Dermatologue">Dermatologue</option>
                    <option value="Kin√©">Kin√©sith√©rapeute</option>
                    <option value="Autre">Autre sp√©cialiste</option>
                </select>
            </div>
            <div>
                <label class="block text-sm font-medium mb-2">Praticien</label>
                <input type="text" name="praticien" placeholder="Dr. Martin">
            </div>
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium mb-2">Date *</label>
                    <input type="date" name="date" required>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">Heure</label>
                    <input type="time" name="heure">
                </div>
            </div>
            <div>
                <label class="block text-sm font-medium mb-2">Notes</label>
                <textarea name="notes" rows="3" placeholder="Motif, recommandations..."></textarea>
            </div>
            <button type="submit" class="btn-primary w-full">Ajouter</button>
        </form>
    `);
}

function saveRDV(e) {
    e.preventDefault();
    const form = e.target;
    appData.sante.rdv.push({
        id: Date.now(),
        type: form.type.value,
        praticien: form.praticien.value,
        date: form.date.value,
        heure: form.heure.value,
        notes: form.notes.value,
        createdAt: new Date().toISOString()
    });
    saveData(appData);
    closeModal();
    showSanteTab('rdv');
    showToast('RDV ajout√© !', 'success');
}

function supprimerRDV(index) {
    if (confirm('Supprimer ce RDV ?')) {
        appData.sante.rdv.splice(index, 1);
        saveData(appData);
        showSanteTab('rdv');
    }
}

function renderStatsTab() {
    const scoreSante = calculateScoreSante();
    const sommeil = appData.sante.sommeil;
    const avgSommeil = sommeil.length > 0 ? (sommeil.reduce((sum, s) => sum + s.heures, 0) / sommeil.length).toFixed(1) : 0;
    const sportThisMonth = appData.loisirs.sports.filter(s => {
        const date = new Date(s.date);
        const monthAgo = new Date();
        monthAgo.setMonth(monthAgo.getMonth() - 1);
        return date >= monthAgo;
    }).length;
    
    return `
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="card">
                <h3 class="font-bold mb-4">üìä Vue d'ensemble</h3>
                <div class="space-y-4">
                    <div>
                        <div class="flex justify-between mb-2">
                            <span class="text-sm">Score Global</span>
                            <span class="font-bold">${scoreSante}%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${scoreSante}%"></div>
                        </div>
                    </div>
                    <div>
                        <div class="flex justify-between mb-2">
                            <span class="text-sm">Sommeil moyen</span>
                            <span class="font-bold">${avgSommeil}h / ${appData.preferences.sleepGoal || 7.5}h</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${Math.min(100, (avgSommeil / (appData.preferences.sleepGoal || 7.5)) * 100)}%"></div>
                        </div>
                    </div>
                    <div>
                        <div class="flex justify-between mb-2">
                            <span class="text-sm">Sport ce mois</span>
                            <span class="font-bold">${sportThisMonth} s√©ances</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${Math.min(100, (sportThisMonth / 12) * 100)}%"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <h3 class="font-bold mb-4">üéØ Recommandations</h3>
                <div class="space-y-3">
                    ${scoreSante < 50 ? `
                        <div class="p-3 bg-red-50 rounded-lg border border-red-200">
                            <p class="text-sm text-red-800">‚ö†Ô∏è Votre score sant√© est faible. Priorisez sommeil et sport !</p>
                        </div>
                    ` : ''}
                    ${avgSommeil < (appData.preferences.sleepGoal || 7.5) ? `
                        <div class="p-3 bg-orange-50 rounded-lg border border-orange-200">
                            <p class="text-sm text-orange-800">üò¥ Essayez de dormir ${((appData.preferences.sleepGoal || 7.5) - avgSommeil).toFixed(1)}h de plus par nuit</p>
                        </div>
                    ` : `
                        <div class="p-3 bg-green-50 rounded-lg border border-green-200">
                            <p class="text-sm text-green-800">‚úÖ Votre sommeil est optimal !</p>
                        </div>
                    `}
                    ${sportThisMonth < 12 ? `
                        <div class="p-3 bg-blue-50 rounded-lg border border-blue-200">
                            <p class="text-sm text-blue-800">üí™ Objectif: 3 s√©ances/semaine (${12 - sportThisMonth} restantes ce mois)</p>
                        </div>
                    ` : `
                        <div class="p-3 bg-green-50 rounded-lg border border-green-200">
                            <p class="text-sm text-green-800">üèÜ Excellent ! Objectif sport atteint !</p>
                        </div>
                    `}
                </div>
            </div>
        </div>
    `;
}

// ========================================
// UTILITAIRES
// ========================================

function formatEuro(amount) {
    return new Intl.NumberFormat('fr-FR', { style: 'currency', currency: 'EUR' }).format(amount);
}

function formatDate(date) {
    return new Date(date).toLocaleDateString('fr-FR');
}

function openModal(title, content) {
    document.getElementById('modalTitle').textContent = title;
    document.getElementById('modalContent').innerHTML = content;
    document.getElementById('modal').classList.add('active');
}

function closeModal() {
    document.getElementById('modal').classList.remove('active');
}

function showToast(message, type) {
    const toast = document.createElement('div');
    toast.className = `fixed top-4 right-4 bg-white px-6 py-3 rounded-lg shadow-lg border-l-4 ${type === 'success' ? 'border-green-500' : 'border-red-500'} z-50`;
    toast.innerHTML = `<p class="font-semibold">${message}</p>`;
    document.body.appendChild(toast);
    setTimeout(() => toast.remove(), 3000);
}

function exportData() {
    const dataStr = JSON.stringify(appData, null, 2);
    const dataBlob = new Blob([dataStr], {type: 'application/json'});
    const url = URL.createObjectURL(dataBlob);
    const link = document.createElement('a');
    link.href = url;
    link.download = `matteo-ecosystem-${new Date().toISOString().split('T')[0]}.json`;
    link.click();
    showToast('Donn√©es export√©es !', 'success');
}

function exportData() {
    const dataStr = JSON.stringify(appData, null, 2);
    const dataBlob = new Blob([dataStr], {type: 'application/json'});
    const url = URL.createObjectURL(dataBlob);
    const link = document.createElement('a');
    link.href = url;
    link.download = `matteo-ecosystem-${new Date().toISOString().split('T')[0]}.json`;
    link.click();
    showToast('Donn√©es export√©es !', 'success');
}

function importData() {
    document.getElementById('fileInput').click();
}

function handleFileImport(event) {
    const file = event.target.files[0];
    if (!file) return;
    
    const reader = new FileReader();
    reader.onload = function(e) {
        try {
            const importedData = JSON.parse(e.target.result);
            
            if (confirm('‚ö†Ô∏è Importer ces donn√©es ? Cela remplacera toutes vos donn√©es actuelles.')) {
                appData = importedData;
                saveData(appData);
                showToast('Donn√©es import√©es avec succ√®s !', 'success');
                showSection('dashboard');
            }
        } catch (error) {
            alert('Erreur lors de l\'import. Fichier invalide.');
        }
    };
    reader.readAsText(file);
    
    // Reset input
    event.target.value = '';
}

// Initialisation
document.addEventListener('DOMContentLoaded', () => {
    // V√©rifier et initialiser les sections tabs
    const dashboardBtn = document.querySelector('.nav-btn');
    if (dashboardBtn) {
        dashboardBtn.classList.add('active');
        showSection('dashboard');
    }
    
    // Initialiser les tabs Loisirs si on est sur la page
    if (currentSection === 'loisirs' && typeof showLoisirsTab === 'function') {
        setTimeout(() => showLoisirsTab('voyages'), 100);
    }
    
    // Initialiser les tabs Sant√© si on est sur la page
    if (currentSection === 'sante' && typeof showSanteTab === 'function') {
        setTimeout(() => showSanteTab('sommeil'), 100);
    }
});
</script>

</body>
</html>
